â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘                          ğŸ¯ QURABLE CHALLENGE ğŸ¯                            â•‘
â•‘                                                                              â•‘
â•‘                      ARQUITECTURA, INFRAESTRUCTURA & API                    â•‘
â•‘                                                                              â•‘
â•‘                        Sistema de GestiÃ³n de Cupones                         â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TABLA DE CONTENIDOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ PARTE 1: INFRAESTRUCTURA AWS
   â€¢ ALB (Application Load Balancer)
   â€¢ ECS Fargate (Servidores)
   â€¢ RDS PostgreSQL (Base de datos)
   â€¢ ElastiCache Redis (CachÃ©)
   â€¢ VPC (Red privada)

ğŸš€ PARTE 2: ESTRATEGIA DE DEPLOYMENT
   â€¢ CI/CD Pipeline
   â€¢ Escalabilidad
   â€¢ Monitoreo
   â€¢ Rollback

ğŸ”Œ PARTE 3: ENDPOINTS API
   â€¢ Coupon Books (3 endpoints)
   â€¢ Coupon Codes (3 endpoints)
   â€¢ Assignments (3 endpoints)
   â€¢ Redemption (3 endpoints)
   â€¢ Health (1 endpoint)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PARTE 1: INFRAESTRUCTURA AWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DIAGRAMA GENERAL - INFRAESTRUCTURA                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   INTERNET - USUARIOS   â”‚
                          â”‚   https://qurable.com   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ HTTPS/HTTP
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ALB (Application Load Balancer)     â”‚
                    â”‚  â€¢ Puerto 443 (SSL/TLS)              â”‚
                    â”‚  â€¢ Distribuye entre ECS tasks        â”‚
                    â”‚  â€¢ Health checks automÃ¡ticos         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                   â”‚                   â”‚
                   â–¼                   â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ECS Task 1     â”‚  â”‚  ECS Task 2     â”‚  â”‚  ECS Task 3     â”‚
        â”‚  Node.js 18 LTS â”‚  â”‚  Node.js 18 LTS â”‚  â”‚  Node.js 18 LTS â”‚
        â”‚  â€¢ 0.5 vCPU     â”‚  â”‚  â€¢ 0.5 vCPU     â”‚  â”‚  â€¢ 0.5 vCPU     â”‚
        â”‚  â€¢ 1 GB RAM     â”‚  â”‚  â€¢ 1 GB RAM     â”‚  â”‚  â€¢ 1 GB RAM     â”‚
        â”‚  â€¢ Puerto 3000  â”‚  â”‚  â€¢ Puerto 3000  â”‚  â”‚  â€¢ Puerto 3000  â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚                    â”‚
             â”‚                    â”‚                    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  REDIS CACHE      â”‚     â”‚  RDS PostgreSQL DB     â”‚
         â”‚  (En memoria)     â”‚     â”‚  (Almacenamiento)      â”‚
         â”‚  â€¢ 13 GB RAM      â”‚     â”‚  â€¢ db.t4g.medium       â”‚
         â”‚  â€¢ 2 nodos        â”‚     â”‚  â€¢ 4 GB RAM            â”‚
         â”‚  â€¢ Locks + TTL    â”‚     â”‚  â€¢ 100 GB SSD          â”‚
         â”‚  â€¢ 5 min expirado â”‚     â”‚  â€¢ Multi-AZ (2 rÃ©plicas)â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£ ALB (APPLICATION LOAD BALANCER) - La Recepcionista
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Â¿QUÃ‰ ES?
  Es la puerta de entrada a tu aplicaciÃ³n. Recibe peticiones de internet y las
  distribuye entre mÃºltiples servidores.

Â¿POR QUÃ‰?
  âœ“ Si un servidor cae, hay otros (resiliencia)
  âœ“ Distribuye carga (algunos usuarios a Task 1, otros a Task 2)
  âœ“ SSL/TLS encriptado (HTTPS seguro)
  âœ“ Health checks automÃ¡ticos

Â¿CÃ“MO FUNCIONA?
  Usuario: https://tupagina.com â†’ peticiÃ³n
  ALB: Recibe peticiÃ³n
  ALB: "Â¿CuÃ¡l servidor estÃ¡ menos ocupado?" â†’ Task 1
  Task 1: Procesa y responde
  ALB: Devuelve respuesta al usuario

CONFIGURACIÃ“N:
  â€¢ Listener: Puerto 443 (HTTPS)
  â€¢ SSL Certificate: AWS ACM (gratis)
  â€¢ Target Group: Apunta a ECS tasks
  â€¢ Health Check: /health (cada 30 seg)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

2ï¸âƒ£ ECS FARGATE - Los Servidores Inteligentes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Â¿QUÃ‰ ES?
  AWS ejecuta tu cÃ³digo Node.js sin que tengas que mantener servidores.
  Es "serverless" pero con control total.

Â¿POR QUÃ‰?
  âœ“ AWS parchea automÃ¡ticamente (seguridad)
  âœ“ Auto-escalado (crecimiento automÃ¡tico)
  âœ“ Pagas solo por uso real (no por servidores 24/7)
  âœ“ Deployment ZERO DOWNTIME (sin apagones)

Â¿CÃ“MO FUNCIONA?

  TRÃFICO NORMAL (10K usuarios/dÃ­a):
  â”œâ”€ ECS corre 2 tasks
  â””â”€ Costo: $35/mes

  BLACK FRIDAY (1M usuarios/dÃ­a):
  â”œâ”€ AWS detecta: CPU > 70%
  â”œâ”€ Auto-crea 3 tasks mÃ¡s
  â”œâ”€ Total: 5-10 tasks corriendo
  â””â”€ Usuarios siguen viendo velocidad normal

  DESPUÃ‰S (vuelve a normal):
  â”œâ”€ AWS detecta: CPU < 50%
  â”œâ”€ Baja tasks extras
  â”œâ”€ Total: 2-3 tasks de nuevo
  â””â”€ Ahorras dinero automÃ¡ticamente

ESPECIFICACIONES POR TASK:
  CPU:           0.5 vCPU (mitad de un procesador)
  RAM:           1 GB (suficiente para Node.js)
  Puerto:        3000 (donde corre la app)
  Imagen:        Docker â†’ ECR de AWS
  Health Check:  /health endpoint

AUTO-SCALING:
  MÃ­nimo:  2 tasks
  MÃ¡ximo:  10 tasks
  Trigger: CPU > 70% â†’ crea mÃ¡s
           CPU < 50% â†’ reduce

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

3ï¸âƒ£ RDS POSTGRESQL - La Base de Datos Confiable
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Â¿QUÃ‰ ES?
  Base de datos SQL donde se guarda TODO:
  â€¢ Libros de cupones
  â€¢ CÃ³digos de cupones
  â€¢ Asignaciones a usuarios
  â€¢ AuditorÃ­a de redenciones

Â¿POR QUÃ‰ PostgreSQL?
  âœ“ ACID: Garantiza que datos no se pierdan
  âœ“ Transacciones: "Todo o nada" (si falla, se revierte)
  âœ“ SELECT FOR UPDATE: Bloqueo para evitar conflictos
  âœ“ Confiable: Usado por Amazon, Apple, Spotify, bancos

Â¿CÃ“MO FUNCIONA?

  Escenario: 2 usuarios quieren el mismo cupÃ³n

  SIN LOCK (âŒ Inseguro):
    Usuario A lee cupÃ³n
    Usuario B lee cupÃ³n
    Usuario A lo marca como usado
    Usuario B lo marca como usado
    âŒ Â¡PROBLEMA! Dos personas lo usaron

  CON SELECT FOR UPDATE (âœ“ Seguro):
    Usuario A: SELECT * FOR UPDATE â†’ BLOQUEA fila
    Usuario B: SELECT * FOR UPDATE â†’ ESPERA su turno
    Usuario A: Lo marca usado, COMMIT
    Usuario B: Ahora puede leer â†’ ve status=REDEEMED
    Usuario B: Error "Ya fue usado"
    âœ“ SEGURO

ESPECIFICACIONES:
  Clase:         db.t4g.medium (2 vCPU, 4 GB RAM)
  Storage:       100 GB SSD (gp3)
  VersiÃ³n:       PostgreSQL 15.4
  Multi-AZ:      SÃ­ (2 rÃ©plicas en diferentes ubicaciones)
  Backups:       AutomÃ¡ticos cada noche (7 dÃ­as retenciÃ³n)
  Performance:   Insights enabled (para debugging)

MULTI-AZ (High Availability):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Zona Disponibilidad 1   â”‚
  â”‚ PostgreSQL Primaria     â”‚â”€â”€â”€â”
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                â”‚ ReplicaciÃ³n
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚ Zona Disponibilidad 2   â”‚â—„â”€â”€â”˜
  â”‚ PostgreSQL Replica      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Si Zona 1 cae â†’ AWS alza Zona 2 automÃ¡ticamente

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

4ï¸âƒ£ ELASTICACHE REDIS - La Memoria RÃ¡pida
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Â¿QUÃ‰ ES?
  Base de datos ultra-rÃ¡pida que vive en RAM (no en disco).
  Se usa para cosas que necesitan respuesta INMEDIATA.

Â¿POR QUÃ‰?
  PostgreSQL = LENTA (acceso a disco)
    â””â”€ Lectura en ~5ms

  Redis = ULTRA-RÃPIDA (acceso a RAM)
    â””â”€ Lectura en ~0.1ms (50x mÃ¡s rÃ¡pido)

Â¿PARA QUÃ‰ EN NUESTRO SISTEMA?

  LOCKS CON TTL:
    Usuario intenta redimir cupÃ³n
    â”œâ”€ Preguntamos a Redis: Â¿EstÃ¡ bloqueado?
    â”œâ”€ Redis responde en microsegundos: SÃ, hasta las 10:05
    â”œâ”€ Usuario: Error "CupÃ³n no disponible"
    â””â”€ Nadie mÃ¡s puede usarlo (estÃ¡ reservado)

  AUTO-EXPIRACIÃ“N:
    Usuario bloquea cupÃ³n por 5 minutos
    â”œâ”€ Redis.SETEX(key, 300, data)
    â”œâ”€ 5 minutos pasan sin hacer nada
    â”œâ”€ Redis auto-expira la key
    â””â”€ Otro usuario puede usarlo ahora

ESPECIFICACIONES:
  Node Type:     cache.r6g.large (26 GB RAM por nodo)
  Nodos:         2 (Primary + Replica)
  Cluster Mode:  Enabled (distribuciÃ³n de datos)
  Failover:      AutomÃ¡tico (si nodo 1 cae â†’ nodo 2)
  EncriptaciÃ³n:  En trÃ¡nsito + en reposo
  Snapshots:     Diarios (5 dÃ­as retenciÃ³n)

CÃ“MO FUNCIONA EL BLOQUEO:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Usuario intenta redimir cupÃ³n           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Busca en REDIS primero   â”‚
       â”‚ Key: coupon:lock:SUMMER  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Â¿Existe la key?         â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚ SÃ        â”‚ NO
               â”‚           â”‚
           BLOQUEADO   DISPONIBLE
           (Error)     (OK)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

5ï¸âƒ£ VPC - Red Privada Segura
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Â¿QUÃ‰ ES?
  Una red privada dentro de AWS donde vive toda tu aplicaciÃ³n.
  Internet no puede entrar directamente.

Â¿CÃ“MO ESTÃ ORGANIZADO?

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                  VPC - 10.0.0.0/16                  â”‚
  â”‚                                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚  â”‚ SUBNET PÃšBLICA (ALB)                 â”‚           â”‚
  â”‚  â”‚ â€¢ Accesible desde Internet           â”‚           â”‚
  â”‚  â”‚ â€¢ Puerto 443 abierto al mundo        â”‚           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚               â”‚                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚  â”‚ SUBNET PRIVADA (ECS, RDS, Redis)     â”‚           â”‚
  â”‚  â”‚ â€¢ NO accesible desde Internet        â”‚           â”‚
  â”‚  â”‚ â€¢ Solo accesible desde ALB           â”‚           â”‚
  â”‚  â”‚ â”œâ”€ ECS: Solo ALB puede conectar      â”‚           â”‚
  â”‚  â”‚ â”œâ”€ RDS: Solo ECS puede conectar      â”‚           â”‚
  â”‚  â”‚ â””â”€ Redis: Solo ECS puede conectar    â”‚           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚                                                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SECURITY GROUPS (Firewall):

  ALB Security Group:
    Entrada permitida:
      Puerto 80 (HTTP) â†’ 0.0.0.0/0 (mundo entero)
      Puerto 443 (HTTPS) â†’ 0.0.0.0/0 (mundo entero)
    Salida: Cualquier destino

  ECS Security Group:
    Entrada permitida:
      Puerto 3000 (App) â†’ Solo ALB
    Salida: Cualquier destino

  RDS Security Group:
    Entrada permitida:
      Puerto 5432 (PostgreSQL) â†’ Solo ECS
    Salida: Ninguna (no necesita)

  Redis Security Group:
    Entrada permitida:
      Puerto 6379 (Redis) â†’ Solo ECS
    Salida: Ninguna (no necesita)

RESULTADO:
  âœ“ Internet no puede atacar directamente ECS
  âœ“ ECS no puede hablar con internet directamente
  âœ“ Solo flujo permitido: Internet â†’ ALB â†’ ECS â†’ [RDS, Redis]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PARTE 2: ESTRATEGIA DE DEPLOYMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CI/CD PIPELINE - FLUJO AUTOMÃTICO                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  PASO 1: PUSH A GITHUB
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Desarrollador:              â”‚
  â”‚ git add .                   â”‚
  â”‚ git commit -m "Fix bug"     â”‚
  â”‚ git push origin main        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
  PASO 2: GITHUB ACTIONS (CI - Tests)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ AutomÃ¡ticamente:            â”‚
  â”‚ 1. npm ci                   â”‚
  â”‚ 2. npm run lint             â”‚
  â”‚ 3. npm test                 â”‚
  â”‚ 4. npm run build            â”‚
  â”‚ 5. Â¿Todo OK?               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ âŒ FALLA â†’ RECHAZA DEPLOYMENT
           â”‚
           â””â”€ âœ… OK
               â”‚
               â–¼
  PASO 3: BUILD DOCKER IMAGE
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Docker:                     â”‚
  â”‚ 1. Lee Dockerfile           â”‚
  â”‚ 2. Instala dependencias     â”‚
  â”‚ 3. Copia cÃ³digo             â”‚
  â”‚ 4. Crea imagen              â”‚
  â”‚ 5. Tag: qurable-api:latest  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  PASO 4: PUSH A ECR (AWS)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ AWS ECR (Elastic Container  â”‚
  â”‚ Registry):                  â”‚
  â”‚ Guarda imagen Docker        â”‚
  â”‚ URL: 123456.dkr.ecr...      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  PASO 5: DEPLOY A ECS
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ECS (Blue/Green Deploy):    â”‚
  â”‚ 1. Crea 2 nuevas tasks      â”‚
  â”‚ 2. Espera health checks     â”‚
  â”‚ 3. ALB envÃ­a trÃ¡fico nuevo  â”‚
  â”‚ 4. Apaga tasks viejos       â”‚
  â”‚ RESULTADO: ZERO DOWNTIME    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  PASO 6: MIGRACIONES DB
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ECS Run Task:               â”‚
  â”‚ npm run typeorm migration:runâ”‚
  â”‚ Actualiza tablas remotas    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BLUE/GREEN DEPLOYMENT - Sin Apagones
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  SITUACIÃ“N ACTUAL (BLUE):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Task v1 â”‚  â”‚ Task v1 â”‚  â† Sirven usuarios
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘
        â”‚
      ALB
        â”‚
        â–¼
    Usuarios

  DEPLOYMENT (CREANDO GREEN):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Task v1 â”‚  â”‚ Task v1 â”‚  +  â”‚ Task v2 â”‚  â”‚ Task v2 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                            â†‘
        â”‚         ALB              â”‚  (LevantÃ¡ndose...)
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚       TrÃ¡fico split      â”‚
        â–¼                            â–¼
    50% usuarios            â†’ health check... âœ“
    50% usuarios nuevos      â†’ waiting...

  DESPUÃ‰S (CUTOVER):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Task v1 â”‚  â”‚ Task v1 â”‚     â”‚ Task v2 â”‚  â”‚ Task v2 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                (apagÃ¡ndose)           â†‘
                                       â”‚
                                     ALB
                                       â”‚
                                       â–¼
                                   Usuarios

  FINAL (SOLO GREEN):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Task v2 â”‚  â”‚ Task v2 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘
        â”‚
      ALB
        â”‚
        â–¼
    Usuarios (de v1 a v2 SIN apagÃ³n)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESCALABILIDAD AUTOMÃTICA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  MÃ‰TRICA 1: CPU UTILIZATION
  70% â”€â”€â”
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  â”‚ Target tracking scaling â”‚
        â”‚  â”‚ Man = 70% siempre       â”‚
        â”‚  â”‚                         â”‚
  50% â”€â”€â”¤â”€â”€â”¤ Reduce (menos carga)   â”‚
        â”‚  â”‚                         â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  30% â”€â”€â”˜

  ECS RESPONSE:
  CPU < 50% â†’ Baja tasks (ahorra dinero)
  CPU 50-70% â†’ Mantiene
  CPU > 70% â†’ Agrega tasks (escala)

  MÃQUINA DE ESTADOS:

    2 tasks    â†’   3 tasks   â†’   5 tasks   â†’   10 max
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚             â”‚            â”‚            â”‚
  NORMAL        MED CARGA    ALTA CARGA   PICO
  10K req/d     500K req/d   1M req/d    10M req/d
  $35/mes       $300/mes     $740/mes    $2200/mes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RESERVED INSTANCES - Black Friday
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  TÃ­pico (On-Demand):
    $35/mes base
    Black Friday: +$1800 = $1835

  Con Reservas (Ahorro 30-40%):
    Compras reserva: "10 tasks por 24 hrs"
    Black Friday: $600 (em lugar de $1800)
    Ahorras: $1200 en ese dÃ­a

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MONITOREO - CloudWatch
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  AWS monitorea CONSTANTEMENTE:

  âœ“ CPU Utilization           â†’ Â¿EstÃ¡ sobrecargado?
  âœ“ Memory Usage              â†’ Â¿Hay RAM disponible?
  âœ“ Database Connections      â†’ Â¿PostgreSQL estÃ¡ saturado?
  âœ“ Redis Hit Rate            â†’ Â¿CachÃ© estÃ¡ funcionando?
  âœ“ Error Rate                â†’ Â¿Hay errores 5xx?
  âœ“ Response Time             â†’ Â¿Es rÃ¡pido?
  âœ“ Request Count             â†’ Â¿CuÃ¡nto trÃ¡fico?

  ALERTAS AUTOMÃTICAS:

    MÃ©trica anormal â†’ CloudWatch â†’ SNS â†’ Email
    â†“
    DevOps: "CPU estÃ¡ al 95%"
    DevOps: Chequea quÃ© pasÃ³
    DevOps: Arregla problema
    âœ“ Problema resuelto

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ROLLBACK - Volver AtrÃ¡s si Falla
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Escenario: Nuevo deployment tiene bug

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ OPCIÃ“N 1: AUTOMÃTICO (Deployment Failure Tolerance)     â”‚
  â”‚                                                           â”‚
  â”‚ AWS detecta:                                            â”‚
  â”‚   â€¢ 5% de requests fallan                              â”‚
  â”‚   â€¢ Health checks retornan 500                          â”‚
  â”‚   â€¢ Circuit breaker se activa                           â”‚
  â”‚                                                           â”‚
  â”‚ AWS automÃ¡ticamente:                                   â”‚
  â”‚   â€¢ Detiene rolling deployment                          â”‚
  â”‚   â€¢ Vuelve a versiÃ³n anterior                           â”‚
  â”‚   â€¢ Usuarios NO notan nada                              â”‚
  â”‚                                                           â”‚
  â”‚ Tiempo de recuperaciÃ³n: < 1 minuto âœ“                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ OPCIÃ“N 2: MANUAL (DevOps interviene)                    â”‚
  â”‚                                                           â”‚
  â”‚ 1. DevOps ve alerta en CloudWatch                       â”‚
  â”‚ 2. Ejecuta:                                             â”‚
  â”‚    aws ecs update-service \                             â”‚
  â”‚      --task-definition qurable-api:1                    â”‚
  â”‚                                                           â”‚
  â”‚ 3. ECS vuelve a v1 en 2 minutos                         â”‚
  â”‚ 4. Entonces investiga quÃ© fallÃ³                         â”‚
  â”‚ 5. Arregla bug y hace nuevo deployment                  â”‚
  â”‚                                                           â”‚
  â”‚ Tiempo total: 5-10 minutos                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PARTE 3: ENDPOINTS API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          RESUMEN DE ENDPOINTS - 13 TOTAL                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ“š COUPON BOOKS (3)
     POST   /coupon-books            â†’ Crear libro
     GET    /coupon-books            â†’ Listar libros
     GET    /coupon-books/:id        â†’ Ver un libro

  ğŸ’³ COUPON CODES (3)
     POST   /coupon-codes/generate   â†’ Generar cÃ³digos
     POST   /coupon-codes/upload     â†’ Subir CSV
     GET    /coupon-codes/book/:id   â†’ Listar cÃ³digos

  ğŸ‘¤ ASSIGNMENTS (3)
     POST   /assignments/random      â†’ Asignar aleatoriamente
     POST   /assignments/:code       â†’ Asignar especÃ­fico
     GET    /assignments/user/:id    â†’ Ver mis cupones

  ğŸ”’ REDEMPTION (3)
     POST   /coupons/:code/lock      â†’ Bloquear cupÃ³n
     POST   /coupons/:code/unlock    â†’ Desbloquear cupÃ³n
     POST   /coupons/:code/redeem    â†’ Usar cupÃ³n

  ğŸ’“ HEALTH (1)
     GET    /health                  â†’ Check de salud

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£ COUPON BOOKS - Crear Promociones
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  ANALOGÃA: Como crear una cartuchera vacÃ­a. Existe pero sin lÃ¡pices (cupones).

  POST /coupon-books
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  REQUEST:
  {
    "businessId": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Verano 2026",
    "description": "Cupones de 20% descuento",
    "maxCodesPerUser": 2,        â† MÃ¡ximo cupones por usuario
    "maxRedeemsPerUser": 1,      â† MÃ¡ximo usos por cupÃ³n
    "totalCodesExpected": 1000,  â† CuÃ¡ntos cupones vamos a generar
    "expiresAt": "2026-12-31T23:59:59Z"
  }

  RESPONSE (201 Created):
  {
    "id": "book-001",
    "businessId": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Verano 2026",
    "status": "DRAFT",           â† AÃºn no activo
    "generatedCount": 0,         â† 0 cupones generados
    "maxCodesPerUser": 2,
    "maxRedeemsPerUser": 1,
    "isActive": false,
    "createdAt": "2026-02-07T10:00:00Z"
  }

  VALIDACIONES (Zod):
    âœ“ businessId: UUID vÃ¡lido
    âœ“ name: string no vacÃ­o
    âœ“ description: opcional
    âœ“ maxCodesPerUser: nÃºmero > 0
    âœ“ expiresAt: fecha futura

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  GET /coupon-books
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  PARÃMETROS (Query):
    ?businessId=xxx       â†’ Filtra por negocio
    ?status=ACTIVE        â†’ Filtra por estado
    ?limit=50            â†’ LÃ­mite de resultados
    ?offset=0            â†’ PaginaciÃ³n

  RESPONSE (200 OK):
  [
    {
      "id": "book-001",
      "name": "Verano 2026",
      "status": "ACTIVE",
      "generatedCount": 500,
      "totalCodesExpected": 1000
    },
    {
      "id": "book-002",
      "name": "Navidad 2025",
      "status": "CLOSED",
      "generatedCount": 1000
    }
  ]

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  GET /coupon-books/:id
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  EJEMPLO: GET /coupon-books/book-001

  RESPONSE (200 OK):
  {
    "id": "book-001",
    "name": "Verano 2026",
    "description": "Cupones 20% descuento",
    "status": "ACTIVE",
    "generatedCount": 500,
    "totalCodesExpected": 1000,
    "maxCodesPerUser": 2,
    "maxRedeemsPerUser": 1,
    "isActive": true,
    "isExpired": false,
    "createdAt": "2026-02-07T10:00:00Z"
  }

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

2ï¸âƒ£ COUPON CODES - Generar CÃ³digos
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  ANALOGÃA: Imprimir 1000 boletos de rifa. Cada uno tiene nÃºmero Ãºnico.

  POST /coupon-codes/generate
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  REQUEST:
  {
    "couponBookId": "book-001",
    "quantity": 1000,
    "pattern": "SUMMER-{XXXX}"  â† PatrÃ³n: SUMMER-1234, SUMMER-5678...
  }

  PROCESO INTERNO:
    1. Valida que el libro existe
    2. Loop 1000 veces:
       - Genera nÃºmero aleatorio
       - Reemplaza patrÃ³n: "SUMMER-{XXXX}" â†’ "SUMMER-4532"
       - Inserta en PostgreSQL
    3. Actualiza generatedCount en libro
    4. Retorna resultado

  RESPONSE (200 OK):
  {
    "generatedCount": 1000,
    "couponBookId": "book-001",
    "firstCode": "SUMMER-0001",
    "lastCode": "SUMMER-1000"
  }

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  POST /coupon-codes/upload
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  REQUEST (FormData - CSV):
  Archivo: codes.csv
  Content:
    SUMMER-ABC123,valid
    SUMMER-DEF456,valid
    SUMMER-GHI789,valid

  PROCESO INTERNO:
    1. Lee CSV
    2. Detecta duplicados (rechaza si ve SUMMER-ABC123 dos veces)
    3. Valida formato de cada lÃ­nea
    4. Bulk insert en PostgreSQL (rÃ¡pido)
    5. Retorna estadÃ­sticas

  RESPONSE (200 OK):
  {
    "uploadedCount": 3,
    "duplicatesCount": 0,
    "invalidRowsCount": 0,
    "couponBookId": "book-001"
  }

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  GET /coupon-codes/book/:bookId
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  PARÃMETROS:
    ?status=AVAILABLE  â†’ Solo cupones sin asignar
    ?limit=50         â†’ MÃ¡ximo a traer
    ?offset=0         â†’ PaginaciÃ³n

  RESPONSE (200 OK):
  {
    "data": [
      {
        "id": "code-001",
        "code": "SUMMER-4532",
        "status": "AVAILABLE",
        "isAssigned": false,
        "createdAt": "2026-02-07T10:00:00Z"
      },
      {
        "id": "code-002",
        "code": "SUMMER-5678",
        "status": "AVAILABLE",
        "isAssigned": false
      }
    ],
    "total": 900,  â† De 1000 totales, 900 aÃºn disponibles
    "limit": 50,
    "offset": 0
  }

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

3ï¸âƒ£ ASSIGNMENTS - Asignar Cupones a Usuarios
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  CASO DE USO #1 & #2: Dar cupones a usuarios

  POST /assignments/random
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  REQUEST:
  {
    "couponBookId": "book-001",
    "userId": "user-juan"
  }

  Â¿QUÃ‰ PASA INTERNAMENTE? (CRÃTICO - TransacciÃ³n ACID)

  BEGIN TRANSACTION
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                      â”‚
  â”‚ 1. SELECT * FROM coupon_books                      â”‚
  â”‚    WHERE id = ? FOR UPDATE                          â”‚
  â”‚    â†’ Bloquea el libro (nadie lo modifica)           â”‚
  â”‚                                                      â”‚
  â”‚ 2. Validar:                                         â”‚
  â”‚    âœ“ Â¿Libro existe?                                â”‚
  â”‚    âœ“ Â¿Libro activo?                                â”‚
  â”‚    âœ“ Â¿Usuario puede tener mÃ¡s cupones?             â”‚
  â”‚      (Si maxCodesPerUser=2, y ya tiene 2: ERROR)   â”‚
  â”‚                                                      â”‚
  â”‚ 3. SELECT * FROM coupon_codes                      â”‚
  â”‚    WHERE couponBookId = ?                          â”‚
  â”‚    AND isAssigned = FALSE                          â”‚
  â”‚    ORDER BY RANDOM()       â† Â¡ALEATORIO!           â”‚
  â”‚    LIMIT 1                                          â”‚
  â”‚    FOR UPDATE SKIP LOCKED   â† Evita conflictos     â”‚
  â”‚    â†’ Busca cÃ³digo disponible (librerÃ­a de 1000)    â”‚
  â”‚                                                      â”‚
  â”‚ 4. UPDATE coupon_codes                             â”‚
  â”‚    SET isAssigned = TRUE                            â”‚
  â”‚    WHERE id = ?                                     â”‚
  â”‚    â†’ Marca cÃ³digo como asignado                     â”‚
  â”‚                                                      â”‚
  â”‚ 5. INSERT INTO coupon_assignments                  â”‚
  â”‚    VALUES (                                         â”‚
  â”‚      id: GENERATE_UUID(),                           â”‚
  â”‚      couponCodeId:Found code,                      â”‚
  â”‚      userId: "user-juan",                           â”‚
  â”‚      code: "SUMMER-4532",                           â”‚
  â”‚      status: "ASSIGNED",                            â”‚
  â”‚      assignedAt: NOW(),                             â”‚
  â”‚      redeemCount: 0                                 â”‚
  â”‚    )                                                â”‚
  â”‚    â†’ Crea registro de asignaciÃ³n                    â”‚
  â”‚                                                      â”‚
  â”‚ 6. COMMIT â† Guarda TODO o nada                      â”‚
  â”‚                                                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  END TRANSACTION

  DIAGRAMA DE FLUJO:

    Usuario A pide cupÃ³n
           â”‚
           â–¼
    System bloquea libro (FOR UPDATE)
           â”‚
           â–¼
    Â¿Usuario tiene < 2 cupones? SÃ
           â”‚
           â–¼
    Busca cÃ³digo aleatorio disponible
           â”‚
           â–¼
    EncontrÃ© SUMMER-4532
           â”‚
           â–¼
    Marco como asignado en DB
           â”‚
           â–¼
    Creo registro en assignments
           â”‚
           â–¼
    COMMIT (guardo TODO)
           â”‚
           â–¼
    Response:
    {
      "code": "SUMMER-4532",
      "status": "ASSIGNED"
    }

  RESPONSE (201 Created):
  {
    "id": "assignment-001",
    "code": "SUMMER-4532",
    "status": "ASSIGNED",
    "assignedAt": "2026-02-07T10:00:00Z"
  }

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  POST /assignments/:code
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  REQUEST: POST /assignments/SUMMER-4532
  {
    "userId": "user-juan"
  }

  DIFERENCIA CON RANDOM:
    Random:     Busca ANY cÃ³digo disponible
    EspecÃ­fico: Busca SOLO ese cÃ³digo

  RESPONSE (201 Created):
  {
    "id": "assignment-002",
    "code": "SUMMER-4532",
    "status": "ASSIGNED",
    "assignedAt": "2026-02-07T10:02:00Z"
  }

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  GET /assignments/user/:userId
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  EJEMPLO: GET /assignments/user/user-juan

  RESPONSE (200 OK):
  [
    {
      "id": "assignment-001",
      "code": "SUMMER-4532",
      "status": "ASSIGNED",
      "assignedAt": "2026-02-07T10:00:00Z"
    },
    {
      "id": "assignment-002",
      "code": "SUMMER-7890",
      "status": "LOCKED",        â† EstÃ¡ en carrito
      "lockedAt": "2026-02-07T10:05:00Z",
      "lockedUntil": "2026-02-07T10:10:00Z"
    },
    {
      "id": "assignment-003",
      "code": "SUMMER-1111",
      "status": "REDEEMED",      â† Ya fue usado
      "redeemedAt": "2026-02-07T09:55:00Z"
    }
  ]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

4ï¸âƒ£ REDEMPTION - Lock/Unlock/Redeem
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  MÃQUINA DE ESTADOS DE UN CUPÃ“N:

    Para cupÃ³n de 1 mismo uso:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚AVAILABLE â”‚â”€â”€â”€â–¶â”‚ASSIGNEDâ”‚â”€â”€â”€â–¶â”‚  LOCKED  â”‚â”€â”€â”€â–¶â”‚ REDEEMED â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      (Generado)      (Dado al      (En carrito)    (Usado -
                      usuario)                       No se puede
                                                     usar mÃ¡s)

    Para cupÃ³n de 3 usos:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚AVAILABLE â”‚â”€â”€â”€â–¶â”‚ASSIGNEDâ”‚â”€â”€â”€â–¶â”‚  LOCKED  â”‚â”€â”€â”€â–¶â”‚ASSIGNEDâ”‚ â† Vuelve!
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                    REDEEM #1
                                        â”‚
                      (Se repite 2 veces mÃ¡s)
                                        â”‚
                                        â–¼
                                      REDEEMED (despuÃ©s de 3 redeem)

  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  POST /coupons/:code/lock
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Caso de Uso #4: Usuario mete cupÃ³n en carrito

  REQUEST: POST /coupons/SUMMER-4532/lock
  {
    "userId": "user-juan"
  }

  PROCESO INTERNO:

    BEGIN TRANSACTION
    â”‚
    â”œâ”€ 1. SELECT * FROM coupon_assignments FOR UPDATE
    â”‚     â†’ Busca y bloquea la asignaciÃ³n
    â”‚
    â”œâ”€ 2. Valida:
    â”‚     âœ“ Â¿Le pertenece al usuario?
    â”‚     âœ“ Â¿EstÃ¡ en estado ASSIGNED o LOCKED?
    â”‚
    â”œâ”€ 3. UPDATE coupon_assignments SET status = 'LOCKED'
    â”‚     â†’ Cambia estado en DB
    â”‚
    â”œâ”€ 4. Redis.SETEX("coupon:lock:SUMMER-4532", 300, data)
    â”‚     â†’ Bloquea en cachÃ© por 5 minutos
    â”‚     â†’ Auto-expira si pasan 5 min sin hacer nada
    â”‚
    â”œâ”€ 5. INSERT INTO redemption_audit
    â”‚     (action='LOCK', userId, IP, User-Agent)
    â”‚     â†’ Registra quiÃ©n bloqueÃ³, cuÃ¡ndo, desde dÃ³nde
    â”‚
    â””â”€ COMMIT â†’ Guarda todo

  Â¿QUÃ‰ PASA SI OTRO USUARIO INTENTA USARLO?

    Usuario B: POST /coupons/SUMMER-4532/redeem
           â”‚
           â–¼
    Sistema busca en Redis:
           â”‚
           â–¼
    Redis: "SÃ­, estÃ¡ bloqueado hasta las 10:05"
           â”‚
           â–¼
    System: Error 409 (Conflict)
    {
      "error": "Coupon is locked",
      "lockedUntil": "2026-02-07T10:05:00Z"
    }
           â”‚
           â–¼
    Usuario B: "CupÃ³n no disponible"

  RESPONSE (200 OK):
  {
    "code": "SUMMER-4532",
    "status": "LOCKED",
    "lockedAt": "2026-02-07T10:00:00Z",
    "lockedUntil": "2026-02-07T10:05:00Z"  â† 5 minutos
  }

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  POST /coupons/:code/unlock
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Caso de Uso #5: Usuario saca cupÃ³n del carrito sin comprar

  REQUEST: POST /coupons/SUMMER-4532/unlock
  {
    "userId": "user-juan"
  }

  PROCESO INTERNO:

    BEGIN TRANSACTION
    â”‚
    â”œâ”€ 1. SELECT * FROM coupon_assignments FOR UPDATE
    â”‚     â†’ Bloquea la asignaciÃ³n
    â”‚
    â”œâ”€ 2. Valida:
    â”‚     âœ“ Â¿Le pertenece?
    â”‚     âœ“ Â¿EstÃ¡ LOCKED?
    â”‚
    â”œâ”€ 3. UPDATE status = 'ASSIGNED'
    â”‚     â†’ Vuelve a estado anterior
    â”‚
    â”œâ”€ 4. Redis.DEL("coupon:lock:SUMMER-4532")
    â”‚     â†’ Limpia bloqueo del cachÃ©
    â”‚
    â”œâ”€ 5. INSERT INTO redemption_audit (action='UNLOCK')
    â”‚     â†’ Registra debloqueo
    â”‚
    â””â”€ COMMIT

  RESPONSE (200 OK):
  {
    "code": "SUMMER-4532",
    "status": "ASSIGNED"  â† Ahora disponible de nuevo
  }

  NOTA: Si pasan 5 minutos sin unlock:
    Redis auto-expira la key
    CupÃ³n se desbloquea automÃ¡ticamente
    Otro usuario puede usarlo ahora

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  POST /coupons/:code/redeem
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Caso de Uso #3 + #6: Usuario confirma compra y USAR cupÃ³n

  REQUEST: POST /coupons/SUMMER-4532/redeem
  {
    "userId": "user-juan"
  }

  PROCESO INTERNO (CRÃTICO - MULTI-REDEEM):

    BEGIN TRANSACTION
    â”‚
    â”œâ”€ 1. SELECT ca.*, cc.*, cb.maxRedeemsPerUser
    â”‚     FROM coupon_assignments ca
    â”‚     JOIN coupon_codes cc
    â”‚     JOIN coupon_books cb
    â”‚     WHERE ca.code = ?
    â”‚     FOR UPDATE OF ca
    â”‚     â†’ Lee asignaciÃ³n + cÃ³digo + libro (todo bloqueado)
    â”‚
    â”œâ”€ 2. Valida:
    â”‚     âœ“ Â¿Existe?
    â”‚     âœ“ Â¿Le pertenece?
    â”‚     âœ“ Â¿EstÃ¡ en ASSIGNED o LOCKED?
    â”‚
    â”œâ”€ 3. LÃ“GICA MULTI-REDEEM:
    â”‚
    â”‚     currentRedeemCount = 0
    â”‚     maxRedeems = 1          (default)
    â”‚
    â”‚     REDENCIÃ“N #1:
    â”‚     â”œâ”€ Incrementa: redeemCount = 1
    â”‚     â”œâ”€ Â¿Es final? (1 >= 1) SÃ
    â”‚     â”œâ”€ Status = "REDEEMED"
    â”‚     â””â”€ isFinalRedeem = true
    â”‚
    â”‚     O SI maxRedeems = 3:
    â”‚     REDENCIÃ“N #1:
    â”‚     â”œâ”€ redeemCount = 1
    â”‚     â”œâ”€ Â¿Es final? (1 >= 3) NO
    â”‚     â”œâ”€ Status = "ASSIGNED" (vuelve a estar disponible)
    â”‚     â””â”€ isFinalRedeem = false
    â”‚
    â”‚     REDENCIÃ“N #2:
    â”‚     â”œâ”€ redeemCount = 2
    â”‚     â”œâ”€ Â¿Es final? (2 >= 3) NO
    â”‚     â”œâ”€ Status = "ASSIGNED"
    â”‚     â””â”€ isFinalRedeem = false
    â”‚
    â”‚     REDENCIÃ“N #3:
    â”‚     â”œâ”€ redeemCount = 3
    â”‚     â”œâ”€ Â¿Es final? (3 >= 3) SÃ
    â”‚     â”œâ”€ Status = "REDEEMED"
    â”‚     â””â”€ isFinalRedeem = true âœ“
    â”‚
    â”œâ”€ 4. UPDATE coupon_assignments
    â”‚     SET status = newStatus,
    â”‚         redeemCount = redeemCount + 1
    â”‚
    â”œâ”€ 5. IF estaba LOCKED:
    â”‚     Redis.DEL("coupon:lock:SUMMER-4532")
    â”‚     â†’ Limpia bloqueo
    â”‚
    â”œâ”€ 6. INSERT INTO redemption_audit
    â”‚     (action='REDEEM', previousStatus, newStatus,
    â”‚      redeemCount, maxRedeems, isFinalRedeem, IP, UA)
    â”‚
    â””â”€ COMMIT

  RESPUESTA - CUPÃ“N DE 1 USO (maxRedeems=1):

  {
    "code": "SUMMER-4532",
    "status": "REDEEMED",        â† Â¡TERMINADO!
    "redeemCount": 1,
    "maxRedeems": 1,
    "isFinalRedeem": true,       â† Era la Ãºltima
    "redeemedAt": "2026-02-07T10:00:30Z"
  }

  RESPUESTA - CUPÃ“N DE 3 USOS (maxRedeems=3), REDENCIÃ“N #1:

  {
    "code": "SUMMER-4532",
    "status": "ASSIGNED",        â† Sigue disponible
    "redeemCount": 1,
    "maxRedeems": 3,
    "isFinalRedeem": false,      â† No fue la Ãºltima
    "redeemedAt": null
  }

  RESPUESTA - REDENCIÃ“N #3 (La final):

  {
    "code": "SUMMER-4532",
    "status": "REDEEMED",        â† Â¡AHORA SÃ TERMINA!
    "redeemCount": 3,
    "maxRedeems": 3,
    "isFinalRedeem": true,       â† Fue la Ãºltima
    "redeemedAt": "2026-02-07T10:03:00Z"
  }

  INTENTO DE RE-USO:

  Usuario intenta: POST /coupons/SUMMER-4532/redeem
  Sistema responde:

  HTTP 400 Bad Request
  {
    "error": "Coupon already redeemed",
    "status": "REDEEMED",
    "message": "This coupon has reached its maximum redemption limit"
  }

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

5ï¸âƒ£ HEALTH - Check de Salud
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  GET /health
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Â¿Para quÃ©?
    AWS/CloudWatch verifica que el servidor estÃ¡ vivo

  RESPONSE (200 OK):
  {
    "status": "ok",
    "timestamp": "2026-02-07T10:00:00Z",
    "database": "connected",
    "redis": "connected",
    "uptime": 3600000
  }

  Si algÃºn componente estÃ¡ mal:
  {
    "status": "degraded",
    "database": "connected",
    "redis": "disconnected"  â† ROJO
  }

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SEGURIDAD: PREVENCIÃ“N DE RACE CONDITIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA 1: Dos Usuarios Usan el Mismo CupÃ³n
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  âŒ SIN PROTECCIÃ“N (Desastre):

    Time â”‚ Usuario A           â”‚ Usuario B
    â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    t=0  â”‚ SELECT SUMMER-4532  â”‚
    t=1  â”‚ âœ“ No estÃ¡ usado     â”‚
    t=2  â”‚                     â”‚ SELECT SUMMER-4532
    t=3  â”‚                     â”‚ âœ“ No estÃ¡ usado
    t=4  â”‚ UPDATE status=USED  â”‚
    t=5  â”‚                     â”‚ UPDATE status=USED
    t=6  â”‚ COMMIT              â”‚
    t=7  â”‚                     â”‚ COMMIT
         â”‚
         â””â”€ âŒ Â¡AMBOS CREEN QUE LO USARON!

  âœ… CON POSTGRESQL LOCK (Seguro):

    Time â”‚ Usuario A                    â”‚ Usuario B
    â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    t=0  â”‚ SELECT FOR UPDATE           â”‚
    t=1  â”‚ âœ“ BLOQUEADO (solo yo puedo)â”‚ SELECT FOR UPDATE
    t=2  â”‚ UPDATE status=USED          â”‚ â³ ESPERANDO...
    t=3  â”‚ COMMIT                      â”‚
    t=4  â”‚ âœ“ Completado!              â”‚ â³ ESPERANDO...
    t=5  â”‚                             â”‚ Ahora puedo leer
    t=6  â”‚                             â”‚ âœ“ status=USED
    t=7  â”‚                             â”‚ Error! "Ya usado"
         â”‚
         â””â”€ âœ“ SEGURO - Solo uno lo usÃ³

PROBLEMA 2: Robo de Cupones DespuÃ©s de Bloquear
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  âŒ SIN REDIS TTL (Peligro):

    Usuario A bloquea cupÃ³n
    (sale todo el dÃ­a)
    Usuario A vuelve maÃ±ana
    Usuario A redime el cupÃ³n
    âŒ CupÃ³n "comodÃ­n" - puede usarlo cuÃ¡ndo quiera!

  âœ… CON REDIS TTL (5 minutos):

    Usuario A: POST /lock
    Redis: "OK, bloqueado hasta las 10:05"
    (Usuario A no compra)
    (10:05 llega)
    Redis: Auto-expira
    Usuario B: Ahora puede usarlo
    âœ“ SEGURO - CupÃ³n fue "reservado" solo 5 minutos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FLUJO COMPLETO: UN USUARIO DESDE INICIO A FIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SETUP INICIAL (Admin/Empresa)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. Admin crea un libro de cupones
     POST /coupon-books
     {
       "name": "Verano 2026",
       "maxCodesPerUser": 2,
       "maxRedeemsPerUser": 1,
       "totalCodesExpected": 1000
     }
     Response: {"id": "book-001", "status": "DRAFT"}

  2. Admin genera 1000 cÃ³digos
     POST /coupon-codes/generate
     {
       "couponBookId": "book-001",
       "quantity": 1000
     }
     Response: {"generatedCount": 1000}

  3. Admin activa la campaÃ±a
     PUT /coupon-books/book-001
     {"status": "ACTIVE"}

  âœ“ Sistema listo para usuarios

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

JUAN (Usuario) OBTIENE UN CUPÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  4. Juan entra a la tienda y pide un cupÃ³n
     POST /assignments/random
     {
       "couponBookId": "book-001",
       "userId": "user-juan"
     }

     Â¿Sistema internamente?
       â€¢ SELECT book FOR UPDATE (bloquea libro)
       â€¢ Â¿Juan tiene < 2 cupones? SÃ
       â€¢ ORDER BY RANDOM() busca cÃ³digo
       â€¢ EncontrÃ³: SUMMER-4532
       â€¢ INSERT asignaciÃ³n
       â€¢ COMMIT

     Response: {"code": "SUMMER-4532", "status": "ASSIGNED"}

  5. Juan ve sus cupones
     GET /assignments/user/user-juan
     Response: [{"code": "SUMMER-4532", "status": "ASSIGNED"}]

  âœ“ Juan tiene cupÃ³n

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

JUAN VA DE COMPRAS (Escenario 1: Se arrepiente)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  6. Juan una su cupÃ³n en el carrito
     POST /coupons/SUMMER-4532/lock
     {
       "userId": "user-juan"
     }

     Response: {"code": "SUMMER-4532", "status": "LOCKED"}
     â†’ CupÃ³n bloqueado por 5 minutos
     â†’ Nadie mÃ¡s puede usarlo

  7. Juan ve el precio y se arrepiente ğŸ˜…
     POST /coupons/SUMMER-4532/unlock
     {
       "userId": "user-juan"
     }

     Response: {"code": "SUMMER-4532", "status": "ASSIGNED"}
     â†’ CupÃ³n vuelve a estar disponible
     â†’ Otro usuario puede usarlo ahora

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

JUAN VA DE COMPRAS (Escenario 2: Confirma compra)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  6. Juan mete cupÃ³n al carrito
     POST /coupons/SUMMER-4532/lock
     {"userId": "user-juan"}
     Response: {"status": "LOCKED"}

  7. Juan confirma su compra
     POST /coupons/SUMMER-4532/redeem
     {"userId": "user-juan"}

     Â¿Sistema internamente?
       â€¢ SELECT FOR UPDATE (bloquea asignaciÃ³n)
       â€¢ Â¿Le pertenece? SÃ
       â€¢ redeemCount = 0, maxRedeems = 1
       â€¢ Â¿Es final? SÃ (1 >= 1)
       â€¢ Status = REDEEMED
       â€¢ Redis.DEL(lock) â†’ limpia bloqueo
       â€¢ INSERT audit
       â€¢ COMMIT

     Response:
     {
       "code": "SUMMER-4532",
       "status": "REDEEMED",
       "redeemCount": 1,
       "maxRedeems": 1,
       "isFinalRedeem": true
     }

  âœ“ Compra completada!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

JUAN INTENTA REUSAR EL CUPÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  8. Juan quiere usar el cupÃ³n de nuevo
     POST /coupons/SUMMER-4532/redeem
     {"userId": "user-juan"}

     Sistema: "No, este cupÃ³n ya fue usado"

     Response:
     {
       "error": "Coupon already redeemed",
       "status": "REDEEMED"
     }

  âœ“ Seguridad funcionando - no hay fraude

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ESTADÃSTICAS & NÃšMEROS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPLEMENTACIÃ“N COMPLETADA:

  âœ… Endpoints:              13 total (6 requeridos + 7 bonus)
  âœ… Casos de Uso:           6/6 (100% implementados)
  âœ… LÃ­neas de CÃ³digo:       ~4,500 (TypeScript + SQL)
  âœ… DocumentaciÃ³n:          6 archivos MD + 6 TXT + 2 draw.io
  âœ… Tests:                  test.http con todos los endpoints
  âœ… Database:               PostgreSQL 15 con 5 tablas
  âœ… Cache:                  Redis cluster 13 GB

ARQUITECTURA:

  âœ… Cloud:                  AWS (enterprise-ready)
  âœ… Compute:                ECS Fargate (auto-scaling 2-10)
  âœ… Database:               RDS PostgreSQL Multi-AZ
  âœ… Cache:                  ElastiCache Redis Cluster
  âœ… Load Balancer:          Application Load Balancer
  âœ… CI/CD:                  GitHub Actions automÃ¡tico
  âœ… Security:               VPC privada, Security Groups

COSTOS ESTIMADOS (us-east-1):

  ESCENARIO: TRÃFICO BAJO (10K req/dÃ­a)
  - ECS Fargate (2 tasks):      $35/mes
  - RDS PostgreSQL:              $123/mes
  - ElastiCache Redis:           $275/mes
  - ALB + Data Transfer:         $31/mes
  - CloudWatch + otros:          $10/mes
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  TOTAL:                         $474/mes

  ESCENARIO: TRÃFICO MEDIO (1M req/dÃ­a)
  - ECS Fargate (5 tasks):       $87/mes
  - RDS db.r6g.large:           $245/mes
  - ElastiCache Redis:          $275/mes
  - ALB + Data Transfer:         $90/mes
  - Otros:                       $13/mes
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  TOTAL:                         $740/mes

  ESCENARIO: TRÃFICO ALTO (Black Friday - 10M req/dÃ­a)
  - ECS Fargate (20 tasks):     $350/mes (pro-rated)
  - RDS db.r6g.xlarge:         $650/mes
  - ElastiCache (6 nodos):      $990/mes
  - ALB + Data Transfer (1TB):  $90/mes
  - Otros:                      $120/mes
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  TOTAL:                       $2,200/mes (durante pico)

OPTIMIZACIONES:

  âœ“ Reserved Instances:   -30-40% en costos anuales
  âœ“ Compute Savings Plan: -20% en ECS Fargate
  âœ“ S3 Lifecycle:         -80% en logs archive
  AHORRO ANUAL POTENCIAL: ~$1,500

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                            âœ… CONCLUSIÃ“N

                    QURABLE - 100% COMPLETO Y LISTO

            âœ“ 13 Endpoints implementados y testeados
            âœ“ 6 Casos de Uso totalmente funcionales
            âœ“ Arquitectura AWS enterprise-ready
            âœ“ Seguridad ACID con PostgreSQL + Redis
            âœ“ DocumentaciÃ³n completa (MD, TXT, HTML)
            âœ“ CI/CD Pipeline automÃ¡tico (GitHub Actions)
            âœ“ Auto-scaling (2-10 servidores)
            âœ“ Monitoreo CloudWatch (24/7)
            âœ“ Rollback automÃ¡tico si falla

            ğŸš€ Ready para ProducciÃ³n ğŸš€

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DOCUMENTO GENERADO: Febrero 2026
AUTOR: Qurable Challenge - Equipo TÃ©cnico
VERSIÃ“N: 1.0.0

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
